<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nezya</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  width:100vw;height:100vh;
  background:url("bg.jpg") center/cover no-repeat;
  font-family:Arial;color:white;overflow:hidden
}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.45)}

.top-bar{position:absolute;top:10px;left:50%;transform:translateX(-50%);z-index:5}
.balance{background:#000a;padding:8px 14px;border-radius:16px;font-weight:bold}

.game{width:100%;height:100%;display:flex;align-items:center;justify-content:center}
.character{width:260px;cursor:pointer}

.bottom-menu{
  position:absolute;bottom:20px;left:50%;
  transform:translateX(-50%);
  display:flex;gap:10px
}
.menu-btn{
  padding:10px 16px;border-radius:16px;
  background:#000a;color:white;border:none;font-weight:bold
}

/* –û–ö–ù–ê */
.modal{
  position:fixed;inset:0;background:#000d;
  display:none;justify-content:center;align-items:center;z-index:50
}
.modal-box{
  background:#111;padding:16px;border-radius:16px;width:90%;max-width:420px
}
.item{
  display:flex;justify-content:space-between;
  padding:8px;border-bottom:1px solid #333;cursor:pointer
}
.item.active{color:gold}
</style>
</head>

<body>
<div class="overlay"></div>

<div class="top-bar">
  <div class="balance">üí∞ <span id="coins">0</span></div>
</div>

<div class="game">
  <img id="character" class="character">
</div>

<div class="bottom-menu">
  <button class="menu-btn" onclick="openChars()">üßç –ü–µ—Ä—Å–æ–Ω–∞–∂–∏</button>
  <button class="menu-btn" onclick="openShop()">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
  <button class="menu-btn" onclick="openLB()">üèÜ –¢–æ–ø</button>
</div>

<!-- –ü–ï–†–°–û–ù–ê–ñ–ò -->
<div class="modal" id="chars">
  <div class="modal-box">
    <h2>–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h2>
    <div id="charList"></div>
    <button class="menu-btn" onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- –ú–ê–ì–ê–ó–ò–ù -->
<div class="modal" id="shop">
  <div class="modal-box">
    <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div id="shopList"></div>
    <button class="menu-btn" onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- –õ–ò–î–ï–†–ë–û–†–î -->
<div class="modal" id="leaderboard">
  <div class="modal-box">
    <h2>üèÜ TOP 10</h2>
    <div id="lbList"></div>
    <button class="menu-btn" onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDDs8s4EfQIt3nJlB1ctrLlU2h_Rkgaxcg",
  projectId:"nezya-game"
});
const db=firebase.firestore();

const characters={
  default:{img:"character_default.png",power:1,price:0},
  clicker:{img:"character_clicker.png",power:2,price:100},
  business:{img:"character_business.png",power:4,price:500},
  magnate:{img:"character_magnate.png",power:7,price:1500},
  legendary:{img:"character_legendary.png",power:15,price:5000}
};

let coins=+localStorage.getItem("coins")||0;
let owned=JSON.parse(localStorage.getItem("owned")||'["default"]');
let active=localStorage.getItem("active")||"default";

const coinsEl=document.getElementById("coins");
const characterEl=document.getElementById("character");

function updateUI(){
  coinsEl.textContent=coins;
  characterEl.src=characters[active].img;
}
updateUI();

characterEl.onclick=()=>{
  coins+=characters[active].power;
  updateUI();
};

function openChars(){
  const list=document.getElementById("charList");
  list.innerHTML="";
  for(let k in characters){
    if(!owned.includes(k))continue;
    list.innerHTML+=`
      <div class="item ${k===active?"active":""}"
        onclick="selectChar('${k}')">
        ${k} (x${characters[k].power})
      </div>`;
  }
  document.getElementById("chars").style.display="flex";
}

function selectChar(k){
  active=k;
  localStorage.setItem("active",k);
  updateUI();
  closeAll();
}

function openShop(){
  const list=document.getElementById("shopList");
  list.innerHTML="";
  for(let k in characters){
    if(owned.includes(k))continue;
    list.innerHTML+=`
      <div class="item" onclick="buy('${k}')">
        ${k} ‚Äî üí∞${characters[k].price}
      </div>`;
  }
  document.getElementById("shop").style.display="flex";
}

function buy(k){
  if(coins<characters[k].price)return alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç");
  coins-=characters[k].price;
  owned.push(k);
  localStorage.setItem("owned",JSON.stringify(owned));
  updateUI();
  openShop();
}

function openLB(){
  document.getElementById("leaderboard").style.display="flex";
  db.collection("players").orderBy("coins","desc").limit(10)
    .get().then(s=>{
      const lb=document.getElementById("lbList");
      lb.innerHTML="";
      s.forEach(d=>{
        lb.innerHTML+=`<div>${d.id}: ${d.data().coins}</div>`;
      });
    });
}

function closeAll(){
  document.querySelectorAll(".modal").forEach(m=>m.style.display="none");
}

setInterval(()=>{
  localStorage.setItem("coins",coins);
},2000);
</script>
</body>
</html>
