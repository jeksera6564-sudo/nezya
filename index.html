<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Nezya Game</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;touch-action:manipulation}
body{
  height:100vh;
  background:#020617;
  color:white;
  font-family:Arial;
  overflow:hidden;
}
.hidden{display:none}

/* UI */
.top{
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:14px;
  z-index:5;
}
.stat{
  background:#000a;
  padding:10px 16px;
  border-radius:20px;
  font-weight:900;
}

/* Game */
.center{
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
}
#char{
  width:260px;
  max-width:80vw;
  transition:transform .08s;
}

/* Bottom */
.bottom{
  position:absolute;
  bottom:15%;
  width:100%;
  display:flex;
  justify-content:center;
  gap:12px;
}
button{
  background:#000a;
  border:none;
  border-radius:16px;
  padding:12px 16px;
  color:white;
  font-weight:900;
}

/* Modal */
.modal{
  position:fixed;
  inset:0;
  background:#000c;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10;
}
.modal-box{
  background:#020617;
  padding:18px;
  border-radius:16px;
  width:90%;
  max-width:360px;
}
.modal-box h3{text-align:center;margin-bottom:10px}

/* Register */
#register{
  position:fixed;
  inset:0;
  background:#020617;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:20;
}
.reg-box{
  background:#000;
  padding:24px;
  border-radius:18px;
  width:90%;
  max-width:320px;
  text-align:center;
}
.reg-box input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  margin:12px 0;
  font-size:18px;
}
</style>
</head>

<body>

<!-- REGISTER -->
<div id="register" class="hidden">
  <div class="reg-box">
    <h2>–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫</h2>
    <input id="nickInput" placeholder="–í–∞—à –Ω–∏–∫">
    <button onclick="saveNick()">–ù–∞—á–∞—Ç—å</button>
  </div>
</div>

<!-- GAME -->
<div class="top">
  <div class="stat">üí∞ <span id="coins">0</span></div>
  <div class="stat">üíé <span id="crystals">0</span></div>
</div>

<div class="center">
  <img src="assets/player.png" id="char">
</div>

<div class="bottom">
  <button onclick="openLB()">üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</button>
</div>

<!-- LEADERBOARD -->
<div class="modal" id="lb">
  <div class="modal-box">
    <h3>üèÜ TOP-20</h3>
    <ol id="lbList"></ol>
    <button onclick="closeLB()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDocs, collection, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDDs8s4EfQIt3nJlB1ctrLlU2h_Rkgaxcg",
  authDomain: "nezya-game.firebaseapp.com",
  projectId: "nezya-game",
  storageBucket: "nezya-game.firebasestorage.app",
  messagingSenderId: "866470790249",
  appId: "1:866470790249:web:8c7bfa8b351e8e5d354ef8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// GAME STATE
let coins = 0;
let crystals = 0;
let nickname = localStorage.getItem("nickname");

const coinsEl = document.getElementById("coins");
const crystalsEl = document.getElementById("crystals");
const char = document.getElementById("char");

// REGISTER
if(!nickname){
  document.getElementById("register").classList.remove("hidden");
}

window.saveNick = ()=>{
  const n = document.getElementById("nickInput").value.trim();
  if(n.length<2) return alert("–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –Ω–∏–∫");
  nickname = n;
  localStorage.setItem("nickname",n);
  document.getElementById("register").classList.add("hidden");
};

// CLICK
char.addEventListener("pointerdown",()=>{
  coins += 1;
  crystals += 0.1;
  char.style.transform="scale(.92)";
  setTimeout(()=>char.style.transform="scale(1)",80);
  update();
});

// PASSIVE
setInterval(()=>{
  coins += 1;
  crystals += 0.1;
  update();
},1000);

// UPDATE
function update(){
  coinsEl.textContent = Math.floor(coins);
  crystalsEl.textContent = crystals.toFixed(1);
  saveOnline();
}

// SAVE ONLINE
async function saveOnline(){
  if(!nickname) return;
  await setDoc(doc(db,"players",nickname),{
    nick:nickname,
    coins:Math.floor(coins),
    crystals:Math.floor(crystals),
    time:Date.now()
  });
}

// LEADERBOARD
window.openLB = async ()=>{
  const q = query(collection(db,"players"),orderBy("coins","desc"),limit(20));
  const snap = await getDocs(q);
  const list = document.getElementById("lbList");
  list.innerHTML="";
  snap.forEach(d=>{
    const p=d.data();
    const li=document.createElement("li");
    li.textContent = `${p.nick} ‚Äî ${p.coins}`;
    list.appendChild(li);
  });
  document.getElementById("lb").style.display="flex";
};

window.closeLB = ()=>{
  document.getElementById("lb").style.display="none";
};

</script>
</body>
</html>
