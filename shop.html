<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ú–∞–≥–∞–∑–∏–Ω ‚Äî Nezi</title>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  color:white;
  min-height:100vh;
  background:
    linear-gradient(rgba(0,0,0,.65),rgba(0,0,0,.85)),
    url("assets/shop-bg.jpg") center/cover no-repeat fixed;
}

.top{
  display:flex;
  justify-content:center;
  gap:12px;
  padding:14px;
  flex-wrap:wrap;
}
.balance{
  background:rgba(0,0,0,.65);
  padding:8px 18px;
  border-radius:20px;
  font-size:18px;
}

.back-wrap{text-align:center;margin:6px 0}
.back{
  background:gold;
  padding:8px 22px;
  border-radius:22px;
  color:black;
  font-weight:bold;
  text-decoration:none;
}

.shop{
  padding:20px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
  gap:16px;
  padding-bottom:80px;
}
.item{
  background:rgba(255,255,255,.14);
  border-radius:18px;
  padding:16px;
  text-align:center;
}
.item button{
  margin-top:10px;
  padding:8px 18px;
  border-radius:20px;
  border:none;
  background:gold;
  font-weight:bold;
  cursor:pointer;
}
.item button:disabled{
  background:#666;
  color:#aaa;
}

.float{
  position:fixed;
  font-size:22px;
  font-weight:900;
  pointer-events:none;
  animation:fly 1s ease-out forwards;
  z-index:9999;
}
@keyframes fly{
  from{opacity:1;transform:translateY(0)}
  to{opacity:0;transform:translateY(-60px)}
}
</style>
</head>

<body>

<div class="top">
  <div class="balance">ü™ô <span id="coins">0</span></div>
  <div class="balance">üíé <span id="crystals">0</span></div>
  <div class="balance">‚è± <span id="incomePerSec">0</span>/—Å–µ–∫</div>
</div>

<div class="back-wrap">
  <a href="index.html" class="back">‚¨Ö –ù–∞–∑–∞–¥</a>
</div>

<h1 style="text-align:center">üè¶ –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ—Ö–æ–¥–∞</h1>
<div class="shop" id="incomeShop"></div>

<h2 style="text-align:center">‚ú® –£–ª—É—á—à–µ–Ω–∏—è</h2>
<div class="shop" id="upgradeShop"></div>

<script>
/* ===== –°–û–•–†–ê–ù–ï–ù–ò–Ø ===== */
let coins = +localStorage.getItem("coins") || 0;
let crystals = +localStorage.getItem("crystals") || 0;

let incomes = JSON.parse(localStorage.getItem("incomes")) || {
  lemonade:0, shop:0, factory:0, bank:0, corporation:0, legendary:0
};

let upgrades = JSON.parse(localStorage.getItem("upgrades")) || {
  crystalClick:0,
  crystalIncome:0,
  ultraBoost:0
};

/* ===== –î–ê–ù–ù–´–ï ===== */
const incomeList = {
  lemonade:{name:"üçã –õ–∏–º–æ–Ω–∞–¥", basePrice:300, income:3},
  shop:{name:"üè™ –ú–∞–≥–∞–∑–∏–Ω", basePrice:3000, income:30},
  factory:{name:"üè≠ –§–∞–±—Ä–∏–∫–∞", basePrice:30000, income:300},
  bank:{name:"üè¶ –ë–∞–Ω–∫", basePrice:300000, income:3000},
  corporation:{name:"üè¢ –ö–æ—Ä–ø–æ—Ä–∞—Ü–∏—è", basePrice:900000, income:9000},
  legendary:{name:"üëë –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏—è", basePrice:3000000, income:50000}
};

const crystalUpgrades = {
  crystalClick:{name:"üíé –ö—Ä–∏—Å—Ç–∞–ª–ª—ã —Å –∫–ª–∏–∫–∞", price:30},
  crystalIncome:{name:"üí† –ö—Ä–∏—Å—Ç–∞–ª–ª—ã —Å –¥–æ—Ö–æ–¥–∞", price:40},
  ultraBoost:{name:"üöÄ –£–ª—å—Ç—Ä–∞ x2", price:50}
};

/* ===== –õ–û–ì–ò–ö–ê ===== */
const price = (base,lvl)=>Math.floor(base*(1+lvl*0.6));

function getIncomePerSecond(){
  let sum = 0;
  for(let k in incomeList){
    sum += incomeList[k].income * incomes[k];
  }
  if(upgrades.ultraBoost) sum *= 2;
  return sum;
}

function getCrystalIncome(coins){
  return upgrades.crystalIncome ? Math.floor(coins/5000) : 0;
}

function float(text,x,y,color){
  const e=document.createElement("div");
  e.className="float";
  e.textContent=text;
  e.style.left=x+"px";
  e.style.top=y+"px";
  e.style.color=color;
  document.body.appendChild(e);
  setTimeout(()=>e.remove(),1000);
}

/* ===== –û–§–§–õ–ê–ô–ù ===== */
const last = +localStorage.getItem("lastTime") || Date.now();
const now = Date.now();
const offlineSec = Math.floor((now-last)/1000);
if(offlineSec>5){
  const offCoins = getIncomePerSecond()*offlineSec;
  const offCrystals = getCrystalIncome(offCoins);
  coins += offCoins;
  crystals += offCrystals;
  alert(`–û—Ñ–ª–∞–π–Ω –¥–æ—Ö–æ–¥:\nü™ô +${offCoins}\nüíé +${offCrystals}`);
}

/* ===== UI ===== */
const coinsEl = document.getElementById("coins");
const crystalsEl = document.getElementById("crystals");
const incomeEl = document.getElementById("incomePerSec");
const incomeShop = document.getElementById("incomeShop");
const upgradeShop = document.getElementById("upgradeShop");

function render(){
  coinsEl.textContent = coins;
  crystalsEl.textContent = crystals;
  incomeEl.textContent = getIncomePerSecond();

  incomeShop.innerHTML="";
  for(let k in incomeList){
    const d = incomeList[k];
    const lvl = incomes[k];
    const cost = price(d.basePrice,lvl);

    const el = document.createElement("div");
    el.className="item";
    el.innerHTML=`
      <h3>${d.name}</h3>
      <p>–ö—É–ø–ª–µ–Ω–æ: ${lvl}</p>
      <p>–î–æ—Ö–æ–¥: +${d.income*lvl} ü™ô/—Å–µ–∫</p>
      <p><b>${cost} ü™ô</b></p>
      <button ${coins<cost?"disabled":""}>–ö—É–ø–∏—Ç—å</button>
    `;
    el.querySelector("button").onclick=()=>{
      if(coins<cost) return;
      coins -= cost;
      incomes[k]++;
      save();
    };
    incomeShop.appendChild(el);
  }

  upgradeShop.innerHTML="";
  for(let k in crystalUpgrades){
    const u = crystalUpgrades[k];
    const bought = upgrades[k];
    const el = document.createElement("div");
    el.className="item";
    el.innerHTML=`
      <h3>${u.name}</h3>
      <p><b>${u.price} üíé</b></p>
      <button ${bought||crystals<u.price?"disabled":""}>
        ${bought?"–ö—É–ø–ª–µ–Ω–æ":"–ö—É–ø–∏—Ç—å"}
      </button>
    `;
    el.querySelector("button").onclick=()=>{
      if(crystals<u.price) return;
      crystals -= u.price;
      upgrades[k]=1;
      save();
    };
    upgradeShop.appendChild(el);
  }
}

function save(){
  localStorage.setItem("coins",coins);
  localStorage.setItem("crystals",crystals);
  localStorage.setItem("incomes",JSON.stringify(incomes));
  localStorage.setItem("upgrades",JSON.stringify(upgrades));
  localStorage.setItem("lastTime",Date.now());
  render();
}

/* ===== –¢–ò–ö ===== */
setInterval(()=>{
  const inc = getIncomePerSecond();
  if(inc>0){
    coins += inc;
    const cry = getCrystalIncome(inc);
    crystals += cry;
    float("+"+inc+" ü™ô",window.innerWidth/2,80,"gold");
    if(cry>0) float("+"+cry+" üíé",window.innerWidth/2,120,"cyan");
    save();
  }
},1000);

/* ===== –ö–†–ò–°–¢–ê–õ–õ –° –ö–õ–ò–ö–ê ===== */
document.addEventListener("click",e=>{
  if(upgrades.crystalClick && Math.random()<0.1){
    crystals++;
    float("+1 üíé",e.clientX,e.clientY,"cyan");
    save();
  }
});

render();
</script>
</body>
</html>
